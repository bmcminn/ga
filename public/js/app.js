_.templateSettings.escape=/\{\{-(.*?)\}\}/g,_.templateSettings.interpolate=/\{\{(.+?)\}\}/g,$.fn.extend({serializeJSON:function(e){return e||(e=[]),_.reduce(this.serializeArray(),function(t,i){return i.value&&!(i.name in e)&&(t[i.name]=i.value),t},{})}});var App={};App.vent=_.extend({},Backbone.Events),App.Collections={},App.Models={},App.Views={},App.Collections.SearchableCollection=Backbone.Collection.extend({},{search:function(e,t){var i=$.Deferred();t=t||{};var n=new this([],t);n.url=_.result(n,"url");var o=n.fetch({data:e});return o.done(_.bind(function(){App.vent.trigger("search:done"),i.resolveWith(this.Search,[n])},this)),o.fail(function(){App.vent.trigger("search:fail"),i.reject()}),i.promise()}});var MovieResults=App.Collections.SearchableCollection.extend({url:"http://omdbapi.com/"}),MovieResult=App.Collections.SearchableCollection.extend({url:"http://omdbapi.com/"}),Movie=Backbone.Model.extend(),Movies=Backbone.Collection.extend({model:Movie}),MoviesView=Backbone.View.extend({tagName:"ul",el:"#movies",initialize:function(e){this.bus=e.bus},render:function(){var e=this;return this.collection.each(function(t){var i=t.toJSON().Search;e.$el.html(""),i.forEach(function(t){var i=new MoviesItemView({model:t,bus:e.bus});e.$el.append(i.render().$el)})}),this}}),MoviesItemView=Backbone.View.extend({tagName:"li",events:{click:"onClick"},template:_.template($("#movie-listing").html()),initialize:function(e){this.bus=e.bus},onClick:function(){this.bus.trigger("movie:selected",this.model)},render:function(){return this.$el.html(this.template(this.model)),this}}),MovieDetailsView=Backbone.View.extend({el:"#movie",template:_.template($("#movie-details").html()),initialize:function(e){this.bus=e.bus,console.log("loading:",this)},render:function(){console.log("rendering movie details:",this.model);var e=this.model.models[0].toJSON();this.$el.html(this.template(e))}});App.Views.SearchView=Backbone.View.extend({initialize:function(e){this.bus=e.bus,console.log("search view found!")},events:{submit:"onSubmit"},onSubmit:function(e,t){e.preventDefault(),this.bus.trigger("search:submit",$(e.target).serializeJSON())}});var searchView=new App.Views.SearchView({el:"#movies-search",bus:App.vent});App.vent.on("search:submit",function(e){console.log("search:submit",e);var t=MovieResults.search(e);t.done(function(e){var t=new MoviesView({collection:e,bus:App.vent});t.render()})}),App.vent.on("movie:selected",function(e){console.log("movie:selected",e);var t=MovieResult.search({i:e.imdbID});t.done(function(e){var t=new MovieDetailsView({bus:App.vent,model:e});t.render()})});